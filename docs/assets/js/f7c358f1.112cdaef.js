(self.webpackChunkdoodle_docs=self.webpackChunkdoodle_docs||[]).push([[535],{9263:function(e,n,t){"use strict";t.r(n),t.d(n,{assets:function(){return v},contentTitle:function(){return u},default:function(){return k},frontMatter:function(){return c},metadata:function(){return m},toc:function(){return h}});var a=t(3117),o=t(102),r=(t(7294),t(3905)),i=t(3456),d=t(9877),l=t(8215),p=t(3138),s=["components"],c={hide_title:!0},u="Drag & Drop",m={unversionedId:"dragdrop",id:"dragdrop",title:"Drag & Drop",description:"Drag-and-drop is a form of data transfer between two Views or a View and an external component. The Views involved",source:"@site/docs/dragdrop.mdx",sourceDirName:".",slug:"/dragdrop",permalink:"/doodle/docs/dragdrop",tags:[],version:"current",frontMatter:{hide_title:!0},sidebar:"tutorialSidebar",previous:{title:"Keyboard Input",permalink:"/doodle/docs/keyboard"},next:{title:"UI Components Overview",permalink:"/doodle/docs/ui_components/overview"}},v={},h=[{value:"Required Module",id:"required-module",level:2},{value:"Creating A Source",id:"creating-a-source",level:2},{value:"Receiving Drops",id:"receiving-drops",level:2},{value:"Data Bundles",id:"data-bundles",level:2},{value:"Event Sequence",id:"event-sequence",level:2},{value:"Handling Dragged Files",id:"handling-dragged-files",level:2}],g={toc:h};function k(e){var n=e.components,t=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"drag--drop"},"Drag & Drop"),(0,r.kt)("p",null,"Drag-and-drop is a form of data transfer between two Views or a View and an external component. The Views involved\ncan be within a single app, or separate apps; and the external component may be within a 3rd-party app entirely."),(0,r.kt)("p",null,"There key components involved in drag-and-drop sequence are: a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/dragdrop/DragRecognizer.kt#L63"},(0,r.kt)("inlineCode",{parentName:"a"},"DragRecognizer")),"\nattached to a source View, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/dragdrop/DropReceiver.kt#L20"},(0,r.kt)("inlineCode",{parentName:"a"},"DropReceiver")),"\nlinked to a receiver View, and a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/DataBundle.kt#L133"},(0,r.kt)("inlineCode",{parentName:"a"},"DataBundle")),"."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Either the source or target can be external to the app, meaning there might not be a recognizer or receiver at play."))),(0,r.kt)("p",null,"The operation occurs when the user presses and drags a pointer within a drag-and-drop source, then drags that pointer\nonto a target and releases. Data will be captured from the source and provided to the target, where it can decide\nwhether and how to accept it."),(0,r.kt)("h2",{id:"required-module"},"Required Module"),(0,r.kt)("p",null,"You must include the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Browser/src/jsMain/kotlin/io/nacular/doodle/application/Modules.kt#L87"},(0,r.kt)("inlineCode",{parentName:"a"},"DragDropModule")),"\nin your application in order to enable drag-and-drop. This module imports the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Browser/src/jsMain/kotlin/io/nacular/doodle/application/Modules.kt#L62"},(0,r.kt)("inlineCode",{parentName:"a"},"PointerModule")),"\nas well, so you do not need to do so."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"import io.nacular.doodle.application.Modules.Companion.DragDropModule\n\n// ...\n\nfun main() {\n    // Launch MyApp with drag-drop enabled\n    application(modules = setOf(DragDropModule /*,...*/)) {\n        MyApp(/*...*/)\n    }\n}\n")),(0,r.kt)("h2",{id:"creating-a-source"},"Creating A Source"),(0,r.kt)("p",null,"You can create a drag source by attaching a ",(0,r.kt)("inlineCode",{parentName:"p"},"DragRecognizer")," to any ",(0,r.kt)("inlineCode",{parentName:"p"},"View"),". The recognizer is responsible for initiating\nthe operation in response to a drag ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/event/PointerEvent.kt#L10"},(0,r.kt)("inlineCode",{parentName:"a"},"PointerEvent")),".\nThis is done by implementing ",(0,r.kt)("inlineCode",{parentName:"p"},"dragRecognized"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"interface DragRecognizer {\n    fun dragRecognized(event: PointerEvent): DragOperation?\n}\n")),(0,r.kt)("p",null,"The operation begins whenever a receiver returns a non-null ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/dragdrop/DragRecognizer.kt#L14"},(0,r.kt)("inlineCode",{parentName:"a"},"DragOperation")),"\nfrom ",(0,r.kt)("inlineCode",{parentName:"p"},"dragRecognized"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"DragOperation"),"\ncontains the transfer data, user action (copy, move, link), and visual used to provide feedback during the operation.\nThis object represents the entire lifecycle of the operation and is notified when dragging begins, completes, or is canceled.\nThis allows the source to update based on the outcome of the operation."),(0,r.kt)(d.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"example",label:"Example",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'import io.nacular.doodle.datatransport.dragdrop.DragRecognizer\n\nbutton.dragRecognizer = object: DragRecognizer {\n     override fun dragRecognized(event: PointerEvent) = object: DragOperation {\n         override val bundle         = textBundle(text)\n         override val allowedActions = setOf(Copy, Move)\n         override val visualOffset   = event.location\n         override val visual         = object: Renderable {\n             override val size = Size(button.width, button.height * 2)\n\n             override fun render(canvas: Canvas) {\n                canvas.text(text, color = Red)\n             }\n         }\n\n         override fun completed(action: Action) {\n             if (action == Move) text = ""\n         }\n\n         override fun canceled() {\n            // no-op\n         }\n     }\n }\n'))),(0,r.kt)(l.Z,{value:"example 2",label:"DSL",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'import io.nacular.doodle.datatransport.dragdrop.dragRecognized\n\nbutton.dragRecognizer = dragRecognizer {\n     object: DragOperation {\n         override val bundle         = textBundle(text)\n         override val allowedActions = setOf(Copy, Move)\n         override val visualOffset   = event.location\n         override val visual         = object: Renderable {\n             override val size = Size(button.width, button.height * 2)\n\n             override fun render(canvas: Canvas) {\n                canvas.text(text, color = Red)\n             }\n         }\n\n         override fun completed(action: Action) {\n             if (action == Move) text = ""\n         }\n\n         override fun canceled() {\n            // no-op\n         }\n     }\n }\n')))),(0,r.kt)(p.B,{functionName:"buttonDrag",height:"100",mdxType:"DoodleCodeBlock"}),(0,r.kt)("p",null,"This is an example of a simple recognizer that allows the text from a button to be copied or moved to a target."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Having the ",(0,r.kt)("inlineCode",{parentName:"p"},"PointerEvent")," that triggered the drag lets a recognizer decide which subregion in a View a drag can happen from.\nIt can also produce different data from different regions in a single View."))),(0,r.kt)("h2",{id:"receiving-drops"},"Receiving Drops"),(0,r.kt)("p",null,"You receive drops by attaching a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/dragdrop/DropReceiver.kt#L20"},(0,r.kt)("inlineCode",{parentName:"a"},"DropReceiver")),"\nto any ",(0,r.kt)("inlineCode",{parentName:"p"},"View"),". Dragging a pointer over a ",(0,r.kt)("inlineCode",{parentName:"p"},"View")," with a receiver during a drag-and-rop triggers the ",(0,r.kt)("inlineCode",{parentName:"p"},"dropEnter")," event. Subsequent pointer movement results\nin ",(0,r.kt)("inlineCode",{parentName:"p"},"dropOver")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"dropExit")," events; and releasing the pointer sends the ",(0,r.kt)("inlineCode",{parentName:"p"},"drop")," event. Each of these events provides a\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/dragdrop/DropReceiver.kt#L9"},(0,r.kt)("inlineCode",{parentName:"a"},"DropEvent")),"\nwith information about the data being transferred and the user's intended action."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"DropReceiver")," indicates whether the current drop operation is allowed by returning ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," on any of these events. Or, it\ncan return ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," to signal the drop is not allowed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"button.dropReceiver = object: DropReceiver {\n     override val active = true\n\n     private  fun allowed          (event: DropEvent) = PlainText in event.bundle\n     override fun dropEnter        (event: DropEvent) = allowed(event)\n     override fun dropOver         (event: DropEvent) = allowed(event)\n     override fun dropActionChanged(event: DropEvent) = allowed(event)\n     override fun drop             (event: DropEvent) = event.bundle[PlainText]?.let { button.text = it; true } ?: false\n }\n")),(0,r.kt)(p.B,{functionName:"buttonDrop",height:"100",mdxType:"DoodleCodeBlock"}),(0,r.kt)("p",null,"This is a simple receiver that accepts ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/DataBundle.kt#L84"},(0,r.kt)("inlineCode",{parentName:"a"},"PlainText")),"\ndata and assigns it to the button's text. Try dragging some text onto the button. You can even drag from the previous app's button."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"A ",(0,r.kt)("inlineCode",{parentName:"p"},"View")," can be a source and target for drag-and-drop simultaneously."))),(0,r.kt)("h2",{id:"data-bundles"},"Data Bundles"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"DataBundle")," class manages the underlying data that is transfered between the source and target. This interface\nhas two key methods: ",(0,r.kt)("inlineCode",{parentName:"p"},"contains")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"get"),": both take a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/DataBundle.kt#L45"},(0,r.kt)("inlineCode",{parentName:"a"},"MimeType")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"interface DataBundle {\n    operator fun <T> get     (type: MimeType<T>): T?\n    operator fun <T> contains(type: MimeType<T>): Boolean\n\n    //...\n}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"contains")," method checks whether the bundle has data that matches the given mime-type, and ",(0,r.kt)("inlineCode",{parentName:"p"},"get")," returns it."),(0,r.kt)("h2",{id:"event-sequence"},"Event Sequence"),(0,r.kt)("p",null,"The full sequence of events for an operation goes something like this:"),(0,r.kt)(i.Mermaid,{chart:"sequenceDiagram\n    autonumber\n    participant s as Framework\n    participant r as DragRecognizer\n    participant o as DragOperation\n    participant b as DataBundle\n    participant p as DropReceiver\n\n    s->>r : dragRecognized\n    r--\x3e>s: DragOperation\n    s->>o : bundle, allowed actions, visual, ...\n    s->>p : dropEnter\n    loop\n        s->>p : dropOver, [dropExit]\n    end\n    s->>p : drop\n    p->>b : contains, invoke\n    b--\x3e>p: T\n    s->>o : completed",mdxType:"Mermaid"}),(0,r.kt)("h2",{id:"handling-dragged-files"},"Handling Dragged Files"),(0,r.kt)("p",null,"Drag-and-drop also supports file transfer. This is handled via a ",(0,r.kt)("inlineCode",{parentName:"p"},"DropReceiver"),"--just like any other data type, with\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/datatransport/DataBundle.kt#L98"},(0,r.kt)("inlineCode",{parentName:"a"},"Files")),"\nmime-type indicating which file types are allowed."),(0,r.kt)("p",null,"Try dragging files into the table below. The app will only allow files whose types are selected in the list. The ",(0,r.kt)("inlineCode",{parentName:"p"},"Files")," mime-type\nfetches a collection of files from the bundle, which allows a receiver to handle multiple files in a single drop."),(0,r.kt)(d.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"demo",label:"Demo",mdxType:"TabItem"},(0,r.kt)(p.B,{functionName:"fileDragDrop",height:"300",mdxType:"DoodleCodeBlock"})),(0,r.kt)(l.Z,{value:"code",label:"Drop Receiver",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"object: DropReceiver {\n    private val allowedFileTypes = Files(/*mime types*/)\n\n    override val active = true\n\n    private  fun allowed          (event: DropEvent) = allowedFileTypes in event.bundle\n    override fun dropEnter        (event: DropEvent) = allowed(event)\n    override fun dropOver         (event: DropEvent) = allowed(event)\n    override fun dropActionChanged(event: DropEvent) = allowed(event)\n    override fun drop             (event: DropEvent) = event.bundle[allowedFileTypes]?.let { files ->\n        files.forEach {\n            //...\n        }\n        true\n    } ?: false\n}\n")))))}k.isMDXComponent=!0},1748:function(e,n,t){var a={"./locale":9234,"./locale.js":9234};function o(e){var n=r(e);return t(n)}function r(e){if(!t.o(a,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=r,e.exports=o,o.id=1748}}]);